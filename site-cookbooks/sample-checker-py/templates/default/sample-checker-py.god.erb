(0...<%= node['sample-checker-py'].processes %>).to_a.each do |num|
    God.watch do |w|
        w.group = '<%= node['sample-checker-py'].service %>'
        w.name = "<%= node['sample-checker-py'].service %>-#{num}"
        w.dir = '<%= node['sample-checker-py'].basedir %>'
        w.uid = '<%= node['sample-checker-py'].user %>'
        w.gid = '<%= node['sample-checker-py'].group %>'
        w.log = "<%= node['sample-checker-py'].basedir %>/logs/checker-#{num}.log"
        w.start = '<%= node['sample-checker-py'].basedir %>/.virtualenv/bin/python checker.py'
        w.env = {
            'BEANSTALKD_URI' => '127.0.0.1:11300',
            'LOG_LEVEL' => '<%= node['sample-checker-py'].log_level %>',
            'TUBE_LISTEN' => 'themis.service.<%= node['sample-checker-py'].service %>.listen',
            'TUBE_REPORT' => 'themis.service.<%= node['sample-checker-py'].service %>.report'
        }
        w.stop_signal = 'INT'
        w.keepalive
    end
end
