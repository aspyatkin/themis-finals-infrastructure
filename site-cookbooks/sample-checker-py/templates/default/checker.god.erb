(0...<%= node['themis-finals-sample-checker-py']['processes'] %>).to_a.each do |num|
  God.watch do |w|
    w.group = '<%= node['themis-finals-sample-checker-py']['service_alias'] %>'
    w.name = "<%= node['themis-finals-sample-checker-py']['service_alias'] %>-#{num}"
    w.dir = '<%= node['themis-finals-sample-checker-py']['basedir'] %>'
    w.uid = '<%= node['themis-finals-sample-checker-py']['user'] %>'
    w.gid = '<%= node['themis-finals-sample-checker-py']['group'] %>'
    w.log = "<%= node['themis-finals-sample-checker-py']['basedir'] %>/logs/checker-#{num}.log"
    w.start = '<%= node['themis-finals-sample-checker-py']['basedir'] %>/.virtualenv/bin/python checker.py'
    w.env = {
      'BEANSTALKD_URI' => '<%= node['themis-finals']['beanstalkd']['listen']['address'] %>:<%= node['themis-finals']['beanstalkd']['listen']['port'] %>',
      'LOG_LEVEL' => '<%= node['themis-finals-sample-checker-py']['log_level'] %>',
      'TUBE_LISTEN' => 'themis.service.<%= node['themis-finals-sample-checker-py']['service_alias'] %>.listen',
      'TUBE_REPORT' => 'themis.service.<%= node['themis-finals-sample-checker-py']['service_alias'] %>.report'
    }
    w.stop_signal = 'INT'
    w.keepalive
  end
end
