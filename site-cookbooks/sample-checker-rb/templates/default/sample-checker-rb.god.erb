(0...<%= node['sample-checker-py'].processes %>).to_a.each do |num|
    God.watch do |w|
        w.group = '<%= node['sample-checker-rb'].service %>'
        w.name = "<%= node['sample-checker-rb'].service %>-#{num}"
        w.dir = '<%= node['sample-checker-rb'].basedir %>'
        w.uid = '<%= node['sample-checker-rb'].user %>'
        w.gid = '<%= node['sample-checker-rb'].group %>'
        w.log = "<%= node['sample-checker-rb'].basedir %>/logs/checker-#{num}.log"
        w.start = 'bundle exec ruby checker.rb'
        w.env = {
            'BEANSTALKD_URI' => '127.0.0.1:11300',
            'LOG_LEVEL' => '<%= node['sample-checker-rb'].log_level %>',
            'STDOUT_SYNC' => '<%= node['sample-checker-rb'].stdout_sync %>',
            'TUBE_LISTEN' => 'themis.service.<%= node['sample-checker-rb'].service %>.listen',
            'TUBE_REPORT' => 'themis.service.<%= node['sample-checker-rb'].service %>.report'
        }
        w.stop_signal = 'INT'
        w.keepalive
    end
end
