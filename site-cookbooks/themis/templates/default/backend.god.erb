(0...<%= node.themis.backend.processes %>).to_a.each do |num|
    God.watch do |w|
        w.group = 'backends'
        w.name = "backend-#{num}"
        w.dir = '<%= node.themis.basedir %>'
        w.uid = '<%= node.themis.user %>'
        w.gid = '<%= node.themis.group %>'
        w.log = "<%= node.themis.basedir %>/logs/backend-#{num}.log"
        w.start = 'bundle exec ruby backend.rb'
        w.keepalive
        w.env = {
            'PORT' => "#{3000 + num}",
            'LOG_LEVEL' => '<%= node.themis.log_level %>',
            'STDOUT_SYNC' => '<%= node.themis.stdout_sync %>',
            <% if node.themis.production %>
            'RACK_ENV' => 'production'
            <% else %>
            'RACK_ENV' => 'development'
            <% end %>
        }
    end
end
