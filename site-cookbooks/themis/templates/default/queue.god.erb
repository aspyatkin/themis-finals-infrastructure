(0...<%= node.themis.queue.processes %>).to_a.each do |num|
    God.watch do |w|
        w.group = 'queues'
        w.name = "queue-#{num}"
        w.dir = '<%= node.themis.basedir %>'
        w.uid = '<%= node.themis.user %>'
        w.gid = '<%= node.themis.group %>'
        w.log = "<%= node.themis.basedir %>/logs/queue-#{num}.log"
        w.start = 'bundle exec ruby queue.rb'
        w.env = {
            'LOG_LEVEL' => '<%= node.themis.log_level %>',
            'STDOUT_SYNC' => '<%= node.themis.stdout_sync %>'
        }
        w.keepalive
        w.stop_signal = 'INT'
    end
end
